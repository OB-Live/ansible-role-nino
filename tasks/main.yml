---

- name: "Init logs"
  shell: | 
    echo "============ NÄ¬NO Exec Log ============ " > exec.log
    echo "=                                     = " >> exec.log
    echo "==== from {{ source_db }} " >> exec.log
    echo "====== to {{ target_db }} " >> exec.log
    echo "====== at $(date '+%d/%m/%Y %H:%M:%S')  " >> exec.log
    echo "=                                     = " >> exec.log
  args:
    executable: /bin/bash

- include_tasks: connect.yml

- name: Iterate over entities
  include_tasks: pipeline.yml
  loop: "{{ entities }}"
  loop_control:
    loop_var: entity
  vars: 
    idName: "{{ entity.name }}"
    id_json: "{{ entity.id_json }}"
    id_mask: "{{ entity.id_mask if entity.id_mask is defined else '' }}" 
    yaml_mask: "{{ entity.yaml_mask if entity.yaml_mask is defined else '' }}"

# Post processing
- include_tasks: diff.yml

- include_tasks: cleanup.yml
  ignore_errors: true